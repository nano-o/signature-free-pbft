<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory PBFT</title>
</head>


<body>
<div class="head">
<h1>Theory PBFT</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><a href="PBFT.html"><span>PBFT</span></a><span>
  </span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="../../HOL/HOL/Main.html"><span>Main</span></a><span> </span><span class="quoted"><span>"</span><a href="HOL-Statespace.StateSpaceSyntax.html"><span>HOL-Statespace.StateSpaceSyntax</span></a><span>"</span></span><span> </span><span class="quoted"><span>"</span><a href="HOL-Eisbach.Eisbach.html"><span>HOL-Eisbach.Eisbach</span></a><span>"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.compatible_def|fact"><span class="entity_def" id="PBFT.compatible_def|thm"><span class="entity_def" id="PBFT.compatible_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.compatible|const"><span>compatible</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>compatible</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>::</span></span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order|class"><span class="tclass"><span>order</span></span></a><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b'</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.vars.axioms|fact"><span class="entity_def" id="PBFT.vars.intro|fact"><span class="entity_def" id="PBFT.vars_def|fact"><span class="entity_def" id="PBFT.vars_valuetypes.axioms|fact"><span class="entity_def" id="PBFT.vars_valuetypes.intro|fact"><span class="entity_def" id="PBFT.vars_valuetypes_def|fact"><span class="entity_def" id="PBFT.vars_namespace.distinct_names|fact"><span class="entity_def" id="PBFT.vars_namespace.intro|fact"><span class="entity_def" id="PBFT.vars_namespace_def|fact"><span class="entity_def" id="PBFT.vars|locale"><span class="entity_def" id="PBFT.vars_valuetypes|locale"><span class="entity_def" id="PBFT.vars_namespace|locale"><span class="entity_def" id="PBFT.vars.axioms(2)|thm"><span class="entity_def" id="PBFT.vars.axioms(1)|thm"><span class="entity_def" id="PBFT.vars.intro|thm"><span class="entity_def" id="PBFT.vars_def|thm"><span class="entity_def" id="PBFT.vars_valuetypes.axioms(2)|thm"><span class="entity_def" id="PBFT.vars_valuetypes.axioms(1)|thm"><span class="entity_def" id="PBFT.vars_valuetypes.intro|thm"><span class="entity_def" id="PBFT.vars_valuetypes_def|thm"><span class="entity_def" id="PBFT.vars_namespace.distinct_names|thm"><span class="entity_def" id="PBFT.vars_namespace.intro|thm"><span class="entity_def" id="PBFT.vars_namespace_def|thm"><span class="entity_def" id="PBFT.vars_def|axiom"><span class="entity_def" id="PBFT.vars_valuetypes_def|axiom"><span class="entity_def" id="PBFT.vars_namespace_def|axiom"><span class="entity_def" id="PBFT.vars|const"><span class="entity_def" id="PBFT.vars_valuetypes|const"><span class="entity_def" id="PBFT.vars_namespace|const"><span>statespace</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'p</span></span><span class="main"><span>,</span></span><span> </span><span class="tfree"><span>'v</span></span><span class="main"><span>,</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> vars </span><span class="main"><span>=</span></span><span>
  committed </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'p</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.wellorder|class"><span class="tclass"><span>wellorder</span></span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order|class"><span class="tclass"><span>order</span></span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span class="tconst"><span>bool</span></span></a><span>"</span></span></span><span>
  prepared </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'p</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span class="tconst"><span>bool</span></span></a><span>"</span></span></span><span>
  pre_prepared </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'p</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span class="tconst"><span>bool</span></span></a><span>"</span></span></span><span>
  view </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'p</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>no_notation</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span class="const"><span>Set.member</span></span></a><span>  </span><span class="main"><span>(</span></span><span class="quoted"><span>‹</span><span class="keyword1"><span>'(∈')</span></span><span>›</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>no_notation</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span class="const"><span>Set.member</span></span></a><span>  </span><span class="main"><span>(</span></span><span class="quoted"><span>‹</span><span class="keyword3"><span>(‹notation=‹infix ∈››</span></span><span>_</span><span class="keyword3"><span>/ </span></span><span class="keyword1"><span>∈</span></span><span> _</span><span class="keyword3"><span>)</span></span><span>›</span></span><span> </span><span class="main"><span>[</span></span><span>51</span><span class="main"><span>,</span></span><span> 51</span><span class="main"><span>]</span></span><span> 50</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>print_locale</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#PBFT.vars|locale"><span>vars</span></a><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.axioms|fact"><span class="entity_def" id="PBFT.pbft.intro|fact"><span class="entity_def" id="PBFT.pbft_def|fact"><span class="entity_def" id="PBFT.pbft_axioms.intro|fact"><span class="entity_def" id="PBFT.pbft_axioms_def|fact"><span class="entity_def" id="PBFT.pbft.axioms(2)|thm"><span class="entity_def" id="PBFT.pbft.axioms(1)|thm"><span class="entity_def" id="PBFT.pbft.intro|thm"><span class="entity_def" id="PBFT.pbft_def|thm"><span class="entity_def" id="PBFT.pbft_axioms.intro|thm"><span class="entity_def" id="PBFT.pbft_axioms_def|thm"><span class="entity_def" id="PBFT.pbft_def|axiom"><span class="entity_def" id="PBFT.pbft_axioms_def|axiom"><span>locale</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity_def" id="PBFT.pbft|locale"><span class="entity_def" id="PBFT.pbft|const"><span class="entity_def" id="PBFT.pbft_axioms|const"><span>pbft</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="PBFT.html#PBFT.vars|locale"><span>vars</span></a><span> _ _ _ _ _ _ </span><span class="quoted"><span class="free"><span>project_HOL_bool_'b_fun_'v_fun_'p_fun</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span>  </span><span class="free"><span>project_HOL_bool_'b_fun_'v_fun_'p_fun</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'p</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'v</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.wellorder|class"><span class="tclass"><span>wellorder</span></span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order|class"><span class="tclass"><span>order</span></span></a><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span class="tconst"><span>bool</span></span></a><span>"</span></span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="comment1"><span>― ‹boilerplate to unify type variables›</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>quorum_member</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'p</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><span class="tfree"><span>'q</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span class="tconst"><span>bool</span></span></a><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>infix</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>∈</span></span><span>"</span></span><span> 50</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'p</span></span><span> </span><span class="main"><span>⇒</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span class="tconst"><span>bool</span></span></a><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.quorum_intersection|fact"><span class="entity_def" id="PBFT.pbft.quorum_intersection|thm"><span class="entity_def" id="offset_774..793">quorum_intersection</span></span></span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>⋀</span></span><span> </span><span class="bound"><span>q1</span></span><span> </span><span class="bound"><span>q2</span></span><span> </span><span class="main"><span>.</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="bound"><span>q1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="bound"><span>q2</span></span><span>"</span></span></span><span> </span><span class="comment1"><span>― ‹quorum intersection›</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.inv0_def|fact"><span class="entity_def" id="PBFT.pbft.inv0_def|thm"><span class="entity_def" id="PBFT.pbft.inv0_def_raw|axiom"><span class="entity_def" id="offset_869..879">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.inv0.cong|fact"><span class="entity_def" id="PBFT.pbft.inv0.cong|thm"><span class="entity_def" id="PBFT.pbft.inv0|const"><span class="entity_def" id="offset_880..884">inv0</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹No correct party has pre-prepared, prepared, or committed anything after its current view›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>inv0</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> 
    </span><span class="bound"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.inv1_def|fact"><span class="entity_def" id="PBFT.pbft.inv1_def|thm"><span class="entity_def" id="PBFT.pbft.inv1_def_raw|axiom"><span class="entity_def" id="offset_1115..1125">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.inv1.cong|fact"><span class="entity_def" id="PBFT.pbft.inv1.cong|thm"><span class="entity_def" id="PBFT.pbft.inv1|const"><span class="entity_def" id="offset_1126..1130">inv1</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹If a correct party commits a block, then a quorum has prepared it›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>inv1</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span> </span><span class="bound"><span>q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="bound"><span>q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.inv2_def|fact"><span class="entity_def" id="PBFT.pbft.inv2_def|thm"><span class="entity_def" id="PBFT.pbft.inv2_def_raw|axiom"><span class="entity_def" id="offset_1320..1330">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.inv2.cong|fact"><span class="entity_def" id="PBFT.pbft.inv2.cong|thm"><span class="entity_def" id="PBFT.pbft.inv2|const"><span class="entity_def" id="offset_1331..1335">inv2</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹If a correct party prepares a block, then a quorum has pre-prepared it›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>inv2</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span> </span><span class="bound"><span>q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="bound"><span>q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.inv3_def|fact"><span class="entity_def" id="PBFT.pbft.inv3_def|thm"><span class="entity_def" id="PBFT.pbft.inv3_def_raw|axiom"><span class="entity_def" id="offset_1533..1543">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.inv3.cong|fact"><span class="entity_def" id="PBFT.pbft.inv3.cong|thm"><span class="entity_def" id="PBFT.pbft.inv3|const"><span class="entity_def" id="offset_1544..1548">inv3</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹An correct party only pre-prepares one block per view›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>inv3</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>b'</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.safe_def|fact"><span class="entity_def" id="PBFT.pbft.safe_def|thm"><span class="entity_def" id="PBFT.pbft.safe_def_raw|axiom"><span class="entity_def" id="offset_1710..1720">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.safe.cong|fact"><span class="entity_def" id="PBFT.pbft.safe.cong|thm"><span class="entity_def" id="PBFT.pbft.safe|const"><span class="entity_def" id="offset_1721..1725">safe</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹This definition implies that a no block that is incompatible or longer than b can ever be committed in views preceding v, and only b can be committed in view v.›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>safe</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span> </span><span class="bound"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="bound"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span> </span><span class="bound"><span>q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="bound"><span>q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span>
          </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="bound"><span>b''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="bound"><span>b''</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v'</span></span><span> </span><span class="bound"><span>b'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.inv4_def|fact"><span class="entity_def" id="PBFT.pbft.inv4_def|thm"><span class="entity_def" id="PBFT.pbft.inv4_def_raw|axiom"><span class="entity_def" id="offset_2166..2176">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.inv4.cong|fact"><span class="entity_def" id="PBFT.pbft.inv4.cong|thm"><span class="entity_def" id="PBFT.pbft.inv4|const"><span class="entity_def" id="offset_2177..2181">inv4</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹If a party pre-prepares a block b in view v, then b is safe in v›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>inv4</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>v</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.inv5_def|fact"><span class="entity_def" id="PBFT.pbft.inv5_def|thm"><span class="entity_def" id="PBFT.pbft.inv5_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.inv5.cong|fact"><span class="entity_def" id="PBFT.pbft.inv5.cong|thm"><span class="entity_def" id="PBFT.pbft.inv5|const"><span>inv5</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹No two honest parties prepare different blocks in the same view›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>inv5</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>b'</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Specification of the algorithm›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.init_def|fact"><span class="entity_def" id="PBFT.pbft.init_def|thm"><span class="entity_def" id="PBFT.pbft.init_def_raw|axiom"><span class="entity_def" id="offset_2565..2575">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.init.cong|fact"><span class="entity_def" id="PBFT.pbft.init.cong|thm"><span class="entity_def" id="PBFT.pbft.init|const"><span class="entity_def" id="offset_2576..2580">init</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>init</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span>
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.commit_def|fact"><span class="entity_def" id="PBFT.pbft.commit_def|thm"><span class="entity_def" id="PBFT.pbft.commit_def_raw|axiom"><span class="entity_def" id="offset_2694..2704">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.commit.cong|fact"><span class="entity_def" id="PBFT.pbft.commit.cong|thm"><span class="entity_def" id="PBFT.pbft.commit|const"><span class="entity_def" id="offset_2705..2711">commit</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>commit</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>q</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>q</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>&lt;</span></span><span>committed </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span class="const"><span>True</span></span></a><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><span>&gt;</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.pre_prepare_def|fact"><span class="entity_def" id="PBFT.pbft.pre_prepare_def|thm"><span class="entity_def" id="PBFT.pbft.pre_prepare_def_raw|axiom"><span class="entity_def" id="offset_2939..2949">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.pre_prepare.cong|fact"><span class="entity_def" id="PBFT.pbft.pre_prepare.cong|thm"><span class="entity_def" id="PBFT.pbft.pre_prepare|const"><span class="entity_def" id="offset_2950..2961">pre_prepare</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹pre-prepare a safe block›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>pre_prepare</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="bound"><span>b'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>&lt;</span></span><span>pre_prepared </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span class="const"><span>True</span></span></a><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><span>&gt;</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.prepare_def|fact"><span class="entity_def" id="PBFT.pbft.prepare_def|thm"><span class="entity_def" id="PBFT.pbft.prepare_def_raw|axiom"><span class="entity_def" id="offset_3239..3249">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.prepare.cong|fact"><span class="entity_def" id="PBFT.pbft.prepare.cong|thm"><span class="entity_def" id="PBFT.pbft.prepare|const"><span class="entity_def" id="offset_3250..3257">prepare</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>prepare</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>q</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>q</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>&lt;</span></span><span>prepared </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span class="const"><span>True</span></span></a><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><span>&gt;</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.change_view_def|fact"><span class="entity_def" id="PBFT.pbft.change_view_def|thm"><span class="entity_def" id="PBFT.pbft.change_view_def_raw|axiom"><span class="entity_def" id="offset_3486..3496">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.change_view.cong|fact"><span class="entity_def" id="PBFT.pbft.change_view.cong|thm"><span class="entity_def" id="PBFT.pbft.change_view|const"><span class="entity_def" id="offset_3497..3508">change_view</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹Start a higher view›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>change_view</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>&lt;</span></span><span>view </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>(</span></a></span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.fun_upd|const"><span>)</span></a></span><span class="main"><span>&gt;</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.byzantine_havoc_def|fact"><span class="entity_def" id="PBFT.pbft.byzantine_havoc_def|thm"><span class="entity_def" id="PBFT.pbft.byzantine_havoc_def_raw|axiom"><span class="entity_def" id="offset_3643..3653">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.byzantine_havoc.cong|fact"><span class="entity_def" id="PBFT.pbft.byzantine_havoc.cong|thm"><span class="entity_def" id="PBFT.pbft.byzantine_havoc|const"><span class="entity_def" id="offset_3654..3669">byzantine_havoc</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="comment1"><span>― ‹Byzantine parties can do arbitrary state changes, but correct parties' state is preserved›</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>byzantine_havoc</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> 
        </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
        </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
        </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="bound"><span>v</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span>
        </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p'</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.trans_rel_def|fact"><span class="entity_def" id="PBFT.pbft.trans_rel_def|thm"><span class="entity_def" id="PBFT.pbft.trans_rel_def_raw|axiom"><span class="entity_def" id="offset_4030..4040">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="PBFT.pbft.trans_rel.cong|fact"><span class="entity_def" id="PBFT.pbft.trans_rel.cong|thm"><span class="entity_def" id="PBFT.pbft.trans_rel|const"><span class="entity_def" id="offset_4041..4050">trans_rel</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>trans_rel</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>q</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span> </span><span class="main"><span>≡</span></span><span>
      </span><a class="entity_ref" href="PBFT.html#offset_2705..2711"><span class="const"><span>commit</span></span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>q</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_3250..3257"><span class="const"><span>prepare</span></span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>q</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2950..2961"><span class="const"><span>pre_prepare</span></span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>b</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_3497..3508"><span class="const"><span>change_view</span></span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>p</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>v</span></span></span></span><span>
    </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>∨</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_3654..3669"><span class="const"><span>byzantine_havoc</span></span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>s</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>s'</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_4223..4228">lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.trans_rel_cases|fact"><span class="entity_def" id="PBFT.pbft.trans_rel_cases|thm"><span class="entity_def" id="offset_4229..4244">trans_rel_cases</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>consumes</span></span><span> 1</span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>case_names</span></span><span> commit prepare pre_prepare change_view byzantine_havoc</span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>obtains</span></span></span><span> </span><span class="main"><span>(</span></span><span>commit</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2705..2711"><span class="const"><span>commit</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>prepare</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_3250..3257"><span class="const"><span>prepare</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>pre_prepare</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2950..2961"><span class="const"><span>pre_prepare</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>change_view</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_3497..3508"><span class="const"><span>change_view</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>v</span></span><span>"</span></span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>byzantine_havoc</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_3654..3669"><span class="const"><span>byzantine_havoc</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4223..4228"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4030..4040"><span>trans_rel_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹ bach VCG Methods›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  Verification condition generator methods for invariance proofs.
  These methods automate the common pattern of proving that invariants
  are preserved by transitions.
›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>named_theorems</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.trans_defs|attribute"><span class="entity_def" id="PBFT.pbft.trans_defs|fact"><span>trans_defs</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2694..2704"><span>commit_def</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.trans_defs|attribute"><span class="operator"><span>trans_defs</span></span></a><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_3239..3249"><span>prepare_def</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.trans_defs|attribute"><span class="operator"><span>trans_defs</span></span></a><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2939..2949"><span>pre_prepare_def</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.trans_defs|attribute"><span class="operator"><span>trans_defs</span></span></a><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_3486..3496"><span>change_view_def</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.trans_defs|attribute"><span class="operator"><span>trans_defs</span></span></a><span class="main"><span>]</span></span><span>
</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_3643..3653"><span>byzantine_havoc_def</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.trans_defs|attribute"><span class="operator"><span>trans_defs</span></span></a><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹
  Function update lemmas for VCG.
  </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="free"><span>fun_upd_apply</span></span></span><span class="antiquote"><span>}</span></span></span><span> is already a default simp rule, but we add related rules
  and configure auto to split on conditionals from function updates.
›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Method 1: Unfold everything and apply auto (good for simple invariants)›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.invariance_vcg_auto.invariance_vcg_auto|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.invariance_vcg_auto|method"><span>invariance_vcg_auto</span></span><span> </span><span class="keyword2"><span class="keyword"><span>uses</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.invariance_vcg_auto.inv_def|attribute"><span class="entity_def" id="PBFT.pbft.invariance_vcg_auto.inv_def|fact"><span>inv_def</span></span></span><span> </span><span class="main"><span>=</span></span><span> 
  </span><span class="comment1"><span>― ‹We use , and not ; because that loses context assumptions after the first goal somehow.›</span></span><span>
  </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4030..4040"><span>trans_rel_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#PBFT.pbft.trans_defs|fact"><span class="dynamic"><span class="dynamic"><span>trans_defs</span></span></span></a><span> </span><a class="entity_ref" href="PBFT.html#PBFT.pbft.invariance_vcg_auto.inv_def|fact"><span class="dynamic"><span class="dynamic"><span>inv_def</span></span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span>
   </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_splits|fact"><span>if_splits</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span>
   </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span> </span><span class="main"><span class="keyword3"><span>|</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.fastforce|method"><span class="operator"><span>fastforce</span></span></a><span> </span><span class="main"><span class="keyword3"><span>|</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><span class="main"><span class="keyword3"><span>|</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span> </span><span class="main"><span class="keyword3"><span>|</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Meson/meson_tactic.ML.html#Meson.meson|method"><span class="operator"><span>meson</span></span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>?</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Debug version: prints goals after unfolding›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.invariance_vcg_auto_debug.invariance_vcg_auto_debug|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.invariance_vcg_auto_debug|method"><span>invariance_vcg_auto_debug</span></span><span> </span><span class="keyword2"><span class="keyword"><span>uses</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.invariance_vcg_auto_debug.inv_def|attribute"><span class="entity_def" id="PBFT.pbft.invariance_vcg_auto_debug.inv_def|fact"><span>inv_def</span></span></span><span> </span><span class="main"><span>=</span></span><span> 
  </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4030..4040"><span>trans_rel_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#PBFT.pbft.trans_defs|fact"><span class="dynamic"><span class="dynamic"><span>trans_defs</span></span></span></a><span> </span><a class="entity_ref" href="PBFT.html#PBFT.pbft.invariance_vcg_auto_debug.inv_def|fact"><span class="dynamic"><span class="dynamic"><span>inv_def</span></span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> 
   </span><span class="operator"><span>-</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span>
   </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_splits|fact"><span>if_splits</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Method 2: Structured case split with automatic solving›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.invariance_vcg_cases.invariance_vcg_cases|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.invariance_vcg_cases|method"><span>invariance_vcg_cases</span></span><span> </span><span class="keyword2"><span class="keyword"><span>uses</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.invariance_vcg_cases.inv_def|attribute"><span class="entity_def" id="PBFT.pbft.invariance_vcg_cases.inv_def|fact"><span>inv_def</span></span></span><span> </span><span class="main"><span>=</span></span><span> 
  </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4229..4244"><span>trans_rel_cases</span></a><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#PBFT.pbft.invariance_vcg_cases.inv_def|fact"><span class="dynamic"><span class="dynamic"><span>inv_def</span></span></span></a><span> </span><a class="entity_ref" href="PBFT.html#PBFT.pbft.trans_defs|fact"><span class="dynamic"><span class="dynamic"><span>trans_defs</span></span></span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Method 3: Structured case split, leaving subgoals for manual proof›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.invariance_vcg_split.invariance_vcg_split|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.invariance_vcg_split|method"><span>invariance_vcg_split</span></span><span> </span><span class="main"><span>=</span></span><span> 
  </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4229..4244"><span>trans_rel_cases</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Helper method to prove initialization›</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="PBFT.pbft.prove_init.prove_init|method"><span>method</span></span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.prove_init|method"><span>prove_init</span></span><span> </span><span class="keyword2"><span class="keyword"><span>uses</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.prove_init.inv_def|attribute"><span class="entity_def" id="PBFT.pbft.prove_init.inv_def|fact"><span>inv_def</span></span></span><span> </span><span class="main"><span>=</span></span><span> 
  </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2565..2575"><span>init_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#PBFT.pbft.prove_init.inv_def|fact"><span class="dynamic"><span class="dynamic"><span>inv_def</span></span></span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>‹Induction proofs›</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.inv0_inductive|fact"><span class="entity_def" id="PBFT.pbft.inv0_inductive(2)|thm"><span class="entity_def" id="PBFT.pbft.inv0_inductive(1)|thm"><span>inv0_inductive</span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_880..884"><span class="const"><span>inv0</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_880..884"><span class="const"><span>inv0</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_880..884"><span class="const"><span>inv0</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_880..884"><span class="const"><span>inv0</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.prove_init|method"><span class="operator"><span>prove_init</span></span></a><span> </span><span class="quasi_keyword"><span>inv_def</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_869..879"><span>inv0_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_880..884"><span class="const"><span>inv0</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_880..884"><span class="const"><span>inv0</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.invariance_vcg_auto|method"><span class="operator"><span>invariance_vcg_auto</span></span></a><span> </span><span class="quasi_keyword"><span>inv_def</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_869..879"><span>inv0_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.inv1_inductive|fact"><span class="entity_def" id="PBFT.pbft.inv1_inductive(2)|thm"><span class="entity_def" id="PBFT.pbft.inv1_inductive(1)|thm"><span>inv1_inductive</span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.prove_init|method"><span class="operator"><span>prove_init</span></span></a><span> </span><span class="quasi_keyword"><span>inv_def</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1115..1125"><span>inv1_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.invariance_vcg_auto|method"><span class="operator"><span>invariance_vcg_auto</span></span></a><span> </span><span class="quasi_keyword"><span>inv_def</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1115..1125"><span>inv1_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.inv2_inductive|fact"><span class="entity_def" id="PBFT.pbft.inv2_inductive(2)|thm"><span class="entity_def" id="PBFT.pbft.inv2_inductive(1)|thm"><span>inv2_inductive</span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2565..2575"><span>init_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_1320..1330"><span>inv2_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.invariance_vcg_auto|method"><span class="operator"><span>invariance_vcg_auto</span></span></a><span> </span><span class="quasi_keyword"><span>inv_def</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1320..1330"><span>inv2_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.inv3_inductive|fact"><span class="entity_def" id="PBFT.pbft.inv3_inductive(2)|thm"><span class="entity_def" id="PBFT.pbft.inv3_inductive(1)|thm"><span>inv3_inductive</span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>                                                              
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2565..2575"><span>init_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_1533..1543"><span>inv3_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.invariance_vcg_auto|method"><span class="operator"><span>invariance_vcg_auto</span></span></a><span> </span><span class="quasi_keyword"><span>inv_def</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1533..1543"><span>inv3_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.safe_sanity_check_2|fact"><span class="entity_def" id="PBFT.pbft.safe_sanity_check_2|thm"><span class="entity_def" id="offset_7357..7376">safe_sanity_check_2</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>v</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="comment1"><span>― ‹The same witnesses still work after the transition›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>v</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>v_wit</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q_wit</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>pa</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
    </span><span class="entity_def" id="offset_7571..7579">v_wit_lt</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>v_wit</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span>q_wit</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_wit</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span>
          </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="free"><span>v</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="bound"><span>b''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="bound"><span>b''</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>bc</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>bc</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="bound"><span>bc</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span>witness_exists</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1710..1720"><span>safe_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span>  
      </span><span>q_wit'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_wit</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span>
          </span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="free"><span>v</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="bound"><span>b''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="bound"><span>b''</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>bc</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>bc</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="bound"><span>bc</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> 
      </span><span>witness_exists'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="PBFT.html#PBFT.pbft.invariance_vcg_auto|method"><span class="operator"><span>invariance_vcg_auto</span></span></a><span> </span><span class="quasi_keyword"><span>inv_def</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1710..1720"><span>safe_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1710..1720"><span>safe_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_7571..7579"><span>v_wit_lt</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span> 
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.inv4_inductive|fact"><span class="entity_def" id="PBFT.pbft.inv4_inductive(2)|thm"><span class="entity_def" id="PBFT.pbft.inv4_inductive(1)|thm"><span>inv4_inductive</span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2576..2580"><span class="const"><span>init</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2565..2575"><span>init_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_1710..1720"><span>safe_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span>asm</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_8630..8634">inv4</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_8649..8654">trans</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_4041..4050"><span class="const"><span>trans_rel</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>s'</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_8649..8654"><span>trans</span></a><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4229..4244"><span>trans_rel_cases</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>commit</span><span>
      </span><span class="comment1"><span>― ‹commit doesn't change pre-prepared, but adds to committed›</span></span><span>
      </span><span class="comment1"><span>― ‹New precondition ensures compatibility with blocks pre-prepared at higher views›</span></span><span>
      </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_8630..8634"><span>inv4</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_2694..2704"><span>commit_def</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_1710..1720"><span>safe_def</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_9044..9051">prepare</span><span>
      </span><span class="comment1"><span>― ‹prepare doesn't change pre-prepared or committed›</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.allI|fact"><span>allI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>
        </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_9044..9051"><span>prepare</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_3239..3249"><span>prepare_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="skolem"><span>ba</span></span><span> </span><span class="skolem"><span>va</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_9044..9051"><span>prepare</span></a><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s'</span></span><span> </span><span class="skolem"><span>ba</span></span><span> </span><span class="skolem"><span>va</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_7357..7376"><span>safe_sanity_check_2</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>ba</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>va</span></span></span><span> </span><span class="quoted"><span class="free"><span>s'</span></span></span><span> </span><span class="quoted"><span class="free"><span>p</span></span></span><span> </span><span class="quoted"><span class="free"><span>q</span></span></span><span> </span><span class="quoted"><span class="free"><span>v</span></span></span><span> </span><span class="quoted"><span class="free"><span>b</span></span></span><span class="main"><span>]</span></span><span> 
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4030..4040"><span>trans_rel_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_9664..9675">pre_prepare</span><span>
      </span><span class="comment1"><span>― ‹pre-prepare adds to pre-prepared with safe precondition›</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.allI|fact"><span>allI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>
        </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_9904..9914">pa_correct</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_9664..9675"><span>pre_prepare</span></a><span> 
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10015..10024">pre_in_s'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s'</span></span><span> </span><span class="skolem"><span>ba</span></span><span> </span><span class="skolem"><span>va</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="skolem"><span>ba</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_10157..10161">True</span><span>
          </span><span class="comment1"><span>― ‹Newly pre-prepared block, safe by precondition›</span></span><span>
          </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_9664..9675"><span>pre_prepare</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2939..2949"><span>pre_prepare_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
          </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_10157..10161"><span>True</span></a><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> 
            </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_7357..7376"><span>safe_sanity_check_2</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>ba</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>va</span></span></span><span> </span><span class="quoted"><span class="free"><span>s'</span></span></span><span> </span><span class="quoted"><span class="free"><span>p</span></span></span><span> </span><span class="quoted"><span class="free"><span>q</span></span></span><span> </span><span class="quoted"><span class="free"><span>v</span></span></span><span> </span><span class="quoted"><span class="free"><span>b</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_9664..9675"><span>pre_prepare</span></a><span>
            </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4030..4040"><span>trans_rel_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_10483..10488">False</span><span>
          </span><span class="comment1"><span>― ‹Already pre-prepared in s, inv4 s gives safety›</span></span><span>
          </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_10483..10488"><span>False</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_10015..10024"><span>pre_in_s'</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_9664..9675"><span>pre_prepare</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>"</span></span></span><span>
            </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2939..2949"><span>pre_prepare_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_10664..10666">by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_splits|fact"><span>if_splits</span></a><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_9904..9914"><span>pa_correct</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_10664..10666"><span>this</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="skolem"><span>ba</span></span><span> </span><span class="skolem"><span>va</span></span><span>"</span></span></span><span>
            </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
          </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> 
            </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_7357..7376"><span>safe_sanity_check_2</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>ba</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>va</span></span></span><span> </span><span class="quoted"><span class="free"><span>s'</span></span></span><span> </span><span class="quoted"><span class="free"><span>p</span></span></span><span> </span><span class="quoted"><span class="free"><span>q</span></span></span><span> </span><span class="quoted"><span class="free"><span>v</span></span></span><span> </span><span class="quoted"><span class="free"><span>b</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_9664..9675"><span>pre_prepare</span></a><span>
            </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4030..4040"><span>trans_rel_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_10975..10986">change_view</span><span>
      </span><span class="comment1"><span>― ‹</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><a class="entity_ref" href="PBFT.html#offset_3497..3508"><span class="const"><span>change_view</span></span></a></span><span class="antiquote"><span>}</span></span></span><span> doesn't change </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="free"><span>pre_prepared</span></span></span><span class="antiquote"><span>}</span></span></span><span> or </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="free"><span>committed</span></span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.allI|fact"><span>allI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>
        </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_10975..10986"><span>change_view</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_3486..3496"><span>change_view_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="skolem"><span>ba</span></span><span> </span><span class="skolem"><span>va</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_10975..10986"><span>change_view</span></a><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s'</span></span><span> </span><span class="skolem"><span>ba</span></span><span> </span><span class="skolem"><span>va</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_7357..7376"><span>safe_sanity_check_2</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>ba</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>va</span></span></span><span> </span><span class="quoted"><span class="free"><span>s'</span></span></span><span> </span><span class="quoted"><span class="free"><span>p</span></span></span><span> </span><span class="quoted"><span class="free"><span>q</span></span></span><span> </span><span class="quoted"><span class="free"><span>v</span></span></span><span> </span><span class="quoted"><span class="free"><span>b</span></span></span><span class="main"><span>]</span></span><span> 
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4030..4040"><span>trans_rel_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_11639..11654">byzantine_havoc</span><span>
      </span><span class="comment1"><span>― ‹</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><a class="entity_ref" href="PBFT.html#offset_3654..3669"><span class="const"><span>byzantine_havoc</span></span></a></span><span class="antiquote"><span>}</span></span></span><span> preserves all correct parties' state›</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>intro</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.allI|fact"><span>allI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>
        </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s'</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_11639..11654"><span>byzantine_havoc</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_3643..3653"><span>byzantine_havoc_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>pa</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>pa</span></span><span> </span><span class="skolem"><span>va</span></span><span> </span><span class="skolem"><span>ba</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="skolem"><span>ba</span></span><span> </span><span class="skolem"><span>va</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
        </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_11639..11654"><span>byzantine_havoc</span></a><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s'</span></span><span> </span><span class="skolem"><span>ba</span></span><span> </span><span class="skolem"><span>va</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_7357..7376"><span>safe_sanity_check_2</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.of|attribute"><span class="operator"><span>of</span></span></a><span> </span><span class="quoted"><span class="free"><span>s</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>ba</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>va</span></span></span><span> </span><span class="quoted"><span class="free"><span>s'</span></span></span><span> </span><span class="quoted"><span class="free"><span>p</span></span></span><span> </span><span class="quoted"><span class="free"><span>q</span></span></span><span> </span><span class="quoted"><span class="free"><span>v</span></span></span><span> </span><span class="quoted"><span class="free"><span>b</span></span></span><span class="main"><span>]</span></span><span> 
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_4030..4040"><span>trans_rel_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_12302..12307">lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.prepare_blocks_equal|fact"><span class="entity_def" id="PBFT.pbft.prepare_blocks_equal|thm"><span>prepare_blocks_equal</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p'</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p'</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_12302..12307"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>2</span><span class="main"><span>,</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1320..1330"><span>inv2_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p''</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="free"><span>q</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_12302..12307"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p''</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b'</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q'</span></span><span>›</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_12302..12307"><span>assms</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>b'</span></span><span>›</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1533..1543"><span>inv3_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_13035..13040">lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.safe_not_contradicted|fact"><span class="entity_def" id="PBFT.pbft.safe_not_contradicted|thm"><span class="entity_def" id="offset_13041..13062">safe_not_contradicted</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13035..13040"><span>assms</span></a><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induction.ML.html#HOL.induction|method"><span class="operator"><span>induction</span></span></a><span> </span><span class="quoted"><span class="free"><span>v</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>b</span></span></span><span> </span><span class="quoted"><span class="free"><span>p</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.wellorder_class.less_induct|fact"><span>less_induct</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_13292..13296">less</span><span> </span><span class="skolem"><span>v</span></span><span class="main"><span>)</span></span><span>
  </span><span class="comment1"><span>― ‹Extract witnesses from safe definition›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="skolem"><span>b</span></span><span> </span><span class="skolem"><span>v</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>v_wit</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
    </span><span class="entity_def" id="offset_13390..13400">v_wit_less</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>v_wit</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span class="entity_def" id="offset_13422..13428">q_safe</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>pa</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> 
        </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>view</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.greater_eq|const"><span>≥</span></a></span><span> </span><span class="skolem"><span>v</span></span><span> 
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>v''</span></span><span> </span><span class="bound"><span>b''</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="bound"><span>v''</span></span><span> </span><span class="bound"><span>b''</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>b'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="skolem"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="bound"><span>b'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
    </span><span class="entity_def" id="offset_13614..13623">witness_b</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="skolem"><span>b</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1710..1720"><span>safe_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.auto|method"><span class="operator"><span>auto</span></span></a><span>
  
  </span><span class="comment1"><span>― ‹From inv1, get quorum </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="free"><span>q_prep</span></span></span><span class="antiquote"><span>}</span></span></span><span> that prepared b' at v'›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_13845..13851">q_prep</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>pa</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_prep</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1115..1125"><span>inv1_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  
  </span><span class="comment1"><span>― ‹Case split on relationship between v' and </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="skolem"><span>v_wit</span></span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>consider</span></span></span><span> </span><span class="main"><span>(</span></span><span>before</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="skolem"><span>v_wit</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>at</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>v_wit</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>between</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>v_wit</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13390..13400"><span>v_wit_less</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_14171..14177">before</span><span>
    </span><span class="comment1"><span>― ‹</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="skolem"><span>v_wit</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>: Get witness party and use induction hypothesis›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13614..13623"><span>witness_b</span></a><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p_wit</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_14299..14310">p_wit_props</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_wit</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_wit</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="skolem"><span>b</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    
    </span><span class="comment1"><span>― ‹From inv4, b is safe at </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="skolem"><span>v_wit</span></span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_14299..14310"><span>p_wit_props</span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="skolem"><span>b</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_14502..14504">by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    
    </span><span class="comment1"><span>― ‹Use induction hypothesis to get </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="skolem"><span>b</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13292..13296"><span>less.IH</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13390..13400"><span>v_wit_less</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_14502..14504"><span>this</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_14171..14177"><span>before</span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_14722..14724">at</span><span>
    </span><span class="comment1"><span>― ‹</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>v_wit</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>: use inv2 to get quorum that pre-prepared b', then quorum intersection›</span></span><span>
    </span><span class="comment1"><span>― ‹Pick any party from </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="skolem"><span>q_prep</span></span></span><span class="antiquote"><span>}</span></span></span><span> that prepared b'›</span></span><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_14909..14921">p_prep_props</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p_prep</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13845..13851"><span>q_prep</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span class="main"><span>)</span></span><span>
    </span><span class="comment1"><span>― ‹From inv2, get quorum that pre-prepared b'›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_14909..14921"><span>p_prep_props</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>,</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q_pre</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_15146..15151">q_pre</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>pa</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_pre</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>pa</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1320..1330"><span>inv2_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="comment1"><span>― ‹By quorum intersection, find honest party in both </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="skolem"><span>q</span></span></span><span class="antiquote"><span>}</span></span></span><span> and </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="skolem"><span>q_pre</span></span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p''</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_15351..15360">p''_props</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_pre</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="comment1"><span>― ‹This party pre-prepared </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="free"><span>b'</span></span></span><span class="antiquote"><span>}</span></span></span><span> at </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>v_wit</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_15351..15360"><span>p''_props</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_15146..15151"><span>q_pre</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_14722..14724"><span>at</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="comment1"><span>― ‹But </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="free"><span>q_safe</span></span></span><span class="antiquote"><span>}</span></span></span><span> says </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="skolem"><span>p''</span></span></span><span class="antiquote"><span>}</span></span></span><span> hasn't pre-prepared anything different from </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="skolem"><span>b</span></span></span><span class="antiquote"><span>}</span></span></span><span> at </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="skolem"><span>v_wit</span></span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_15351..15360"><span>p''_props</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13422..13428"><span>q_safe</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>b'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>≠</span></a></span><span> </span><span class="skolem"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="bound"><span>b'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="comment1"><span>― ‹Therefore b' = b›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="skolem"><span>v_wit</span></span><span> </span><span class="free"><span>b'</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>b</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_15973..15980">between</span><span> 
    </span><span class="comment1"><span>― ‹</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="skolem"><span>v_wit</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v'</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> and </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>v'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>: contradiction - quorum </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span class="skolem"><span>q</span></span></span><span class="antiquote"><span>}</span></span></span><span> forbids preparing in this range›</span></span><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p''</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_prep</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13422..13428"><span>q_safe</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_15973..15980"><span>between</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_prep</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13845..13851"><span>q_prep</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v'</span></span><span> </span><span class="free"><span>b'</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="PBFT.pbft.committed_blocks_compatible|fact"><span class="entity_def" id="PBFT.pbft.committed_blocks_compatible|thm"><span>committed_blocks_compatible</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p1</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p1</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p2</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p2</span></span><span>"</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#PBFT.compatible|const"><span class="const"><span>compatible</span></span></a><span> </span><span class="free"><span>b1</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="comment1"><span>― ‹Case split on relationship between v1 and v2›</span></span><span>
  </span><span class="keyword1"><span class="command"><span>consider</span></span></span><span> </span><span class="main"><span>(</span></span><span>v1_lt_v2</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>v1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v2</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>v1_eq_v2</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>v1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>v2</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>v2_lt_v1</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>v2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v1</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.force|method"><span class="operator"><span>force</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Tools/induct.ML.html#HOL.cases|method"><span class="operator"><span>cases</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_16799..16807">v1_lt_v2</span><span>
    </span><span class="comment1"><span>― ‹</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>v1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v2</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>: Show </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>b1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
    </span><span class="comment1"><span>― ‹From inv4, there exists an honest party that pre-prepared b2, so b2 is safe at v2›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p2</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p2</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_17028..17034">q_prep</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_prep</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1115..1125"><span>inv1_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p_prep</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_17028..17034"><span>q_prep</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q_pre</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_17341..17346">q_pre</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_pre</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1320..1330"><span>inv2_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p_pre</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p_pre</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_pre</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_pre</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_pre</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_17341..17346"><span>q_pre</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_pre</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_pre</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>b2</span></span><span> </span><span class="free"><span>v2</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_17676..17678">by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="comment1"><span>― ‹Use </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13041..13062"><span>safe_not_contradicted</span></a><span class="antiquote"><span>}</span></span></span><span> to get </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>b1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13041..13062"><span>safe_not_contradicted</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_17676..17678"><span>this</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_16799..16807"><span>v1_lt_v2</span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p1</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p1</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#PBFT.compatible_def|fact"><span>compatible_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_17959..17967">v1_eq_v2</span><span>
    </span><span class="comment1"><span>― ‹v1 = v2: Show b1 = b2 using inv3›</span></span><span>
    </span><span class="comment1"><span>― ‹Get quorums that prepared both blocks›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p1</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p1</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q1_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_18136..18143">q1_prep</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q1_prep</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1115..1125"><span>inv1_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p2</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p2</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q2_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_18311..18318">q2_prep</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q2_prep</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1115..1125"><span>inv1_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="comment1"><span>― ‹Get quorums that pre-prepared both blocks›</span></span><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p1_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p1_prep</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q1_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p1_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p1_prep</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_18136..18143"><span>q1_prep</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p1_prep</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p1_prep</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q1_pre</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_18685..18691">q1_pre</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q1_pre</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1320..1330"><span>inv2_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p2_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p2_prep</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q2_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p2_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p2_prep</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_18311..18318"><span>q2_prep</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p2_prep</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p2_prep</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q2_pre</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_19011..19017">q2_pre</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q2_pre</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1320..1330"><span>inv2_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="comment1"><span>― ‹By quorum intersection, find honest party in both pre-prepare quorums›</span></span><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p''</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q1_pre</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q2_pre</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q1_pre</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_18685..18691"><span>q1_pre</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="skolem"><span>p''</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q2_pre</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_19011..19017"><span>q2_pre</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="comment1"><span>― ‹By inv3, since p'' pre-prepared both b1 and b2 at the same view, they must be equal›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p''</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>›</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_17959..17967"><span>v1_eq_v2</span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p''</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>b2</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1533..1543"><span>inv3_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#PBFT.compatible_def|fact"><span>compatible_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_19734..19742">v2_lt_v1</span><span>
    </span><span class="comment1"><span>― ‹</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>v2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v1</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>: Show </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>b2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> (symmetric to first case)›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p1</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p1</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_19899..19905">q_prep</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_prep</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1115..1125"><span>inv1_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p_prep</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p_prep</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_19899..19905"><span>q_prep</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_prep</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>q_pre</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
      </span><span class="entity_def" id="offset_20212..20217">q_pre</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>∀</span></a></span><span class="bound"><span>p</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_pre</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>p</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_1320..1330"><span>inv2_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>p_pre</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>p_pre</span></span><span> </span><span class="main"><span>∈</span></span><span> </span><span class="skolem"><span>q_pre</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_pre</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_pre</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_20212..20217"><span>q_pre</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/HOL/Tools/Metis/metis_tactic.ML.html#Metis.metis|method"><span class="operator"><span>metis</span></span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_774..793"><span>quorum_intersection</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="skolem"><span>p_pre</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>pre_prepared</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>p_pre</span></span><span> </span><span class="free"><span>v1</span></span><span> </span><span class="free"><span>b1</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="PBFT.html#offset_1721..1725"><span class="const"><span>safe</span></span></a><span> </span><span class="free"><span>s</span></span><span> </span><span class="free"><span>b1</span></span><span> </span><span class="free"><span>v1</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_2166..2176"><span>inv4_def</span></a><span> </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_20547..20549">by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/ISABELLE_HOME/src/Provers/blast.ML.html#HOL.blast|method"><span class="operator"><span>blast</span></span></a><span>
    </span><span class="comment1"><span>― ‹Use </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13041..13062"><span>safe_not_contradicted</span></a><span class="antiquote"><span>}</span></span></span><span> to get </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>b2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>›</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_13041..13062"><span>safe_not_contradicted</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="PBFT.html#offset_20547..20549"><span>this</span></a><span> </span><a class="entity_ref" href="PBFT.html#offset_19734..19742"><span>v2_lt_v1</span></a><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><span>(</span></span><span class="free"><span>s</span></span><span class="main"><span>⋅</span></span><span>committed</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>p2</span></span><span> </span><span class="free"><span>v2</span></span><span> </span><span class="free"><span>b2</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>¬</span></a></span><span> </span><span class="free"><span>byz</span></span><span> </span><span class="free"><span>p2</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1126..1130"><span class="const"><span>inv1</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1331..1335"><span class="const"><span>inv2</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_1544..1548"><span class="const"><span>inv3</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>‹</span><a class="entity_ref" href="PBFT.html#offset_2177..2181"><span class="const"><span>inv4</span></span></a><span> </span><span class="free"><span>s</span></span><span>›</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>≤</span></a></span><span> </span><span class="free"><span>b1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="PBFT.html#PBFT.compatible_def|fact"><span>compatible_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>